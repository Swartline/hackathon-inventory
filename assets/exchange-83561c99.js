import"./style-970dcbb6.js";import{c as A,d as V,e as T,f as B,h as C,E as d,i,j as H}from"./index-3ab0f3d8.js";(async()=>{var w,L;await WA.onInit();const s=document.getElementById("btn-cancel-item"),g=document.getElementById("overlay-confirm-trade-my-item"),p=document.getElementById("overlay-confirm-trade-remote-item");(w=document.getElementById("closeModal"))==null||w.addEventListener("click",()=>{A(),y()});const E=e=>e===void 0?'<div class="card"></div>':`<div class="card-filled">
              <img src="${e==null?void 0:e.sprite_url}" alt="${e==null?void 0:e.description}" title="${e.name}" style="width:95%">
            </div>`,o=(e,t=[])=>{var M;if(!e)throw new Error("Missing interface");const l=10,k=Math.max(Math.ceil(t.length/10)*10,l);let u="";for(let a=0;a<k;a++)t[a]!==void 0?u+=E(t[a]):u+=E();if(e.innerHTML=u,e===document.getElementById("exchange-cells")){const a=(M=document.getElementById("exchange-cells"))==null?void 0:M.getElementsByClassName("card-filled");for(let c=0;c<a.length;c++)a[c].addEventListener("click",()=>{t[c]!==void 0&&x(t[c])})}},r=document.getElementById("itemModal");function x(e){r&&(r.style.display="block",s==null||s.setAttribute("data-item",String(e.id)))}function b(){(r==null?void 0:r.style.display)==="block"&&(r.style.display="none")}(L=document.getElementById("closeInteractModal"))==null||L.addEventListener("click",b),s==null||s.addEventListener("click",async e=>{const t=e.target.dataset.item,l=await V(t);if(!l)throw new Error("Item not found");l&&(T(l,i,{persist:!1}),b(),await B(l),WA.player.state.saveVariable("trade_confirmed",!1,{public:!0,persist:!1}))});const h=document.getElementById("exchange-cells"),I=document.getElementById("remote-exchange-cells");o(h),o(I);const n=await C(WA.player.state[d]);if(!n)throw new Error("No remote player");WA.player.state.onVariableChange(i).subscribe(e=>{o(h,e)}),n.state.onVariableChange(i).subscribe(async e=>{o(I,e),await WA.player.state.saveVariable("trade_confirmed",!1,{public:!0,persist:!1})}),await WA.player.state.saveVariable("trade_confirmed",!1,{public:!0,persist:!1}),n.state.onVariableChange("trade_confirmed").subscribe(async e=>{e?(p.style.display="block",v()):p.style.display="none"}),WA.player.state.onVariableChange("trade_confirmed").subscribe(e=>{const t=document.querySelector("#btn-valid-exchange");e?(g.style.display="block",t.innerHTML="Modifier",v()):(g.style.display="none",t.innerHTML="Valider")});const _=async()=>{const e=!WA.player.state.trade_confirmed;await WA.player.state.saveVariable("trade_confirmed",e,{public:!0,persist:!1})},y=async()=>{await WA.player.state.saveVariable(d,null,{public:!0,persist:!1})},W=async()=>{y()},m=document.getElementById("btn-cancel-exchange");m==null||m.addEventListener("click",W);const f=document.getElementById("btn-valid-exchange");f==null||f.addEventListener("click",_),n.state.onVariableChange(d).subscribe(async e=>{e||await WA.player.state.saveVariable(d,null,{public:!0,persist:!1}),await A()});const v=async()=>{if(WA.player.state.trade_confirmed===!0&&n.state.trade_confirmed===!0){const e=n.state[i];for(const t of e)await B(t);await H(i,{persist:!1}),await y()}}})();
